<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Register as Patient</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/api.js"></script>
</head>

<body class="bg-light">
    <div id="app" class="container d-flex justify-content-center align-items-center" style="height:100vh;">
        <div class="card p-4 shadow" style="width: 380px;">
            <h3 class="text-center mb-3">Patient Registration</h3>

            <input v-model="name" class="form-control mb-2" placeholder="Full Name">
            <input v-model="age" type="number" class="form-control mb-2" placeholder="Age">
            
            <select v-model="gender" class="form-select mb-2">
                <option disabled value="">Select Gender</option>
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
            </select>

            <input v-model="contact" class="form-control mb-2" placeholder="Contact Number">
            <input v-model="address" class="form-control mb-2" placeholder="Address">

            <hr>

            <input v-model="username" class="form-control mb-2" placeholder="Create Username">
            <input v-model="password" type="password" class="form-control mb-3" placeholder="Create Password">

            <div class="d-grid">
                <button class="btn btn-success" @click="register">Register</button>
            </div>

            <p class="text-danger mt-3 text-center">{{ error }}</p>
            <p class="text-success mt-3 text-center">{{ success }}</p>

            <p class="text-center mt-2">
                <a href="login.html">Already have an account?</a>
            </p>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    name: "",
                    age: "",
                    gender: "",
                    contact: "",
                    address: "",
                    username: "",
                    password: "",
                    error: "",
                    success: ""
                };
            },
            methods: {
                async register() {
                    this.error = "";
                    this.success = "";

                    if (!this.name || !this.age || !this.gender || !this.contact || !this.address || !this.username || !this.password) {
                        this.error = "All fields are required.";
                        return;
                    }

                    try {
                        const res = await API.post("/auth/register", {
                            name: this.name,
                            age: this.age,
                            gender: this.gender,
                            contact: this.contact,
                            address: this.address,
                            username: this.username,
                            password: this.password
                        });

                        this.success = "Registration successful! Redirecting to login...";
                        setTimeout(() => {
                            window.location.href = "login.html";
                        }, 1500);

                    } catch (err) {
                        this.error = err.response?.data?.error || "Registration failed.";
                        console.error(err);
                    }
                }
            }
        }).mount("#app");
    </script>
</body>
</html>
